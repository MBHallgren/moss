<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <link rel="stylesheet" href="/styles.b61e60ae.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="/styles.b61e60ae.js"></script></head>


  <body>
  <!-- Side navigation -->
  <div class="sidenav" id="mySidebar">
    <a href="/index.html" id="">Home</a>
    <a href="/services.html">Services</a>
    <a href="/database.html">Database</a>
    <a href="/dashboard.html">Dashboard</a>
    <a href="/config.html">Config</a>
  </div>
  <!-- Page content -->


  <div class="main" id="main">
    <main data-router-wrapper="">
      <section data-router-view="home" class="home">
        <div class="home-content">
          <div class="home-presentation">
            <h3>Welcome to Pathogen Real Time Typer v1.0.1</h3>
          </div>
          <div class="sub-header-text">
            For documentation on Pathogen Real Time Typer, please visit: GITHUB LINK
          <img src="/folder-blue-documents-icon.72578634.png" alt="home">
        </div>
        <h3>Please select the pathogen real time typer configuration file for your database:</h3>
            <div class="upload-config-file">
              <label for="upload-config-file">Select a config file:</label>
              <input type="file" id="upload-config-file">
              <h3>Contents of your config file:</h3>
              <pre id="file-content"></pre>
              <p style="font-size:16px;">Please make sure that the correct config file was chosen, based on the content of the config file.</p> 
            </div>
            
            <br><br>
            <div class="loader"></div>

            Your current config file is: 
            <p id="configfile"></p>
            <hr>

            <div class="prtt-arguments">
                <div class="nanopore-input">
                    <form action="/action_page.php">
                        <label for="nanopore-input">Select Nanopore reads:</label>
                        <input type="file" id="nanopore-input" name="nanopore-input" value=""><br><br>
                    </form>
                </div>
                <div class="illumina-input-forward">
                    <form action="/action_page.php">
                        <label for="illumina-input-forward">Select forward Illumina reads:</label>
                        <input type="file" id="illumina-input-forward" name="illumina-input-forward" value=""><br><br>
                    </form>
                </div>
                <div class="illumina-input-reverse">
                    <form action="/action_page.php">
                        <label for="illumina-input-reverse">Select reverse Illumina reads:</label>
                        <input type="file" id="illumina-input-reverse" name="illumina-input-reverse" value=""><br><br>
                    </form>
                </div>
                <div class="masking-scheme">
                  <form action="/action_page.php">
                      <label for="masking-scheme">Masking Scheme:</label>
                      <input type="file" id="masking-scheme" name="masking-scheme" value=""><br><br>
                  </form>
              </div>

              <div class="prune-distance">
                <form>
                <label for="prune-distance"> Prune distance (Default = 5):</label>
                <input type="text" id="prune-distance" name="prune-distance" value="">
                <br><br>
              </form></div>
              

              <div class="base-calling">
                <form>
                <label for="base-calling"> Nanopore Base Calling Value (Default = 0.7):</label>
                <input type="text" id="base-calling" name="base-calling" value="">
                <br><br>
              </form></div>

              <div class="threads">
                <label for="threads">Number of threads (default = 1):</label>
                <select name="threads" id="threads">
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="4">4</option>
                  <option value="8">8</option>
                </select>
                <br><br>
              </div>

              <div class="output-name">
                <form>
                <label for="output-name"> Analysis output name:</label>
                <input type="text" id="output-name" name="output-name" value="">
                <br><br>
              </form></div>
                <hr>

              <button onclick="submitAnalysis()">Submit Analysis</button>

              Output string: 
              <p id="prtt-call"></p>


              
            </div>
            



      </div></section>
    </main>
  </div>

  <script>var configfile = "None";
document.getElementById("configfile").innerHTML = configfile;

function readSingleFile(e) {
  var file = e.target.files[0];

  if (!file) {
    return;
  }

  var reader = new FileReader();

  reader.onload = function (e) {
    var contents = e.target.result;
    displayContents(contents);
  };

  reader.readAsText(file);
}

function displayContents(contents) {
  var element = document.getElementById('file-content');
  element.textContent = contents;
}

document.getElementById('upload-config-file').addEventListener('change', readSingleFile, false);

function postData(input, exepath) {
  $.ajax({
    type: "POST",
    url: exepath + "prtt_js_wrapper.py",
    data: {
      param: input
    },
    success: callbackFunc
  });
}

function callbackFunc(response) {
  // do something with the response
  console.log(response);
}

function submitAnalysis() {
  var nanopore_input = document.getElementById("nanopore-input").value;

  if (nanopore_input == "") {
    nanopore_input = "";
  } else {
    nanopore_input = document.getElementById("nanopore-input").files[0].path;
  }

  illumina_input_forward = document.getElementById("illumina-input-forward").value;

  if (illumina_input_forward == "") {
    illumina_input_forward = "";
  } else {
    illumina_input_forward = document.getElementById("illumina-input-forward").files[0].path;
  }

  illumina_input_reverse = document.getElementById("illumina-input-reverse").value;

  if (illumina_input_reverse == "") {
    illumina_input_reverse = "";
  } else {
    illumina_input_reverse = document.getElementById("illumina-input-reverse").files[0].path;
  }

  masking_scheme = document.getElementById("masking-scheme").value;

  if (masking_scheme == "") {
    masking_scheme = "";
  } else {
    masking_scheme = document.getElementById("masking-scheme").files[0].path;
  }

  var prune_distance = document.getElementById("prune-distance").value;
  var base_calling = document.getElementById("base-calling").value;
  var threads = document.getElementById("threads").value;
  var output_name = document.getElementById("output-name").value;
  var configfilecontent = document.getElementById("file-content").innerHTML;
  var configobj = JSON.parse(configfilecontent);
  var obj = new Object();
  obj.nanopore_input = nanopore_input;
  obj.illumina_input_forward = illumina_input_forward;
  obj.illumina_input_reverse = illumina_input_reverse;
  obj.masking_scheme = masking_scheme;
  obj.prune_distance = prune_distance;
  obj.base_calling = base_calling;
  obj.threads = threads;
  obj.output_name = output_name;
  obj.configfilecontent = configfilecontent;
  var configJSONString = JSON.stringify(obj);
  console.log(configobj.exepath);
  console.log(configJSONString);
  postData(configJSONString, configobj.exepath);
}</script>
  </body>
</html>
